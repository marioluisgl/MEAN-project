{"version":3,"sources":["page.js"],"names":["mongoose","maxDocs","self","page","query","options","resolve","reject","model","countDocuments","_conditions","err","total","setOptions","limit","count","skip","start","exec","results","Query","prototype","callback","defaults","then","result","catch","initialize"],"mappings":"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","sourcesContent":["export default (mongoose) => {\n\tlet\n\t\tmaxDocs = -1,\n\t\tself = {};\n\n\tfunction page (query, options) {\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\treturn query.model.countDocuments(query._conditions, function (err, total) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn reject(err);\n\t\t\t\t}\n\n\t\t\t\tquery.setOptions({\n\t\t\t\t\tlimit : options.count,\n\t\t\t\t\tskip : options.start\n\t\t\t\t});\n\n\t\t\t\treturn query.exec((err, results) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn reject(err);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn resolve({\n\t\t\t\t\t\toptions,\n\t\t\t\t\t\tresults : results || [],\n\t\t\t\t\t\ttotal\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tmongoose.Query.prototype.page = function (options, callback) {\n\t\tlet\n\t\t\tdefaults = {\n\t\t\t\tcount : maxDocs,\n\t\t\t\tstart : 0\n\t\t\t},\n\t\t\tquery = this;\n\n\t\toptions = options || defaults;\n\t\t// this might be getting a little long;\n\t\toptions.start = (options && options.start && parseInt(options.start, 10) ? parseInt(options.start, 10) : defaults.start);\n\t\toptions.count = (options && options.count && parseInt(options.count, 10) ? parseInt(options.count, 10) : defaults.count);\n\n\t\tif (maxDocs > 0 && (options.count > maxDocs || options.count === 0)) {\n\t\t\toptions.count = maxDocs;\n\t\t}\n\n\t\t// if no callback is supplied, return a Promise\n\t\tif (typeof callback === 'undefined') {\n\t\t\treturn page(query, options);\n\t\t}\n\n\t\t// execute and utilize the callback\n\t\treturn page(query, options)\n\t\t\t.then(function (result) {\n\t\t\t\treturn callback(null, result);\n\t\t\t})\n\t\t\t.catch(function (err) {\n\t\t\t\treturn callback(err);\n\t\t\t});\n\t};\n\n\tself.initialize = (options) => {\n\t\tif (options) {\n\t\t\tmaxDocs = options.maxDocs || maxDocs;\n\t\t}\n\t};\n\n\treturn self;\n};\n"],"file":"page.js"}